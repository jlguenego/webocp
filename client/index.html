<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Web OCP</title>

		<link rel="stylesheet" href="css/main.css" />
		<link rel="stylesheet" href="css/file_manager.css" />
		<link rel="stylesheet" href="css/cover.css" />

		<!-- JQUERY / JQUERY UI -->
		<script src="_ext/jquery-1.10.2.min.js"></script>
		<script src="_ext/jquery-ui-1.10.3/ui/minified/jquery-ui.min.js"></script>
		<link rel="stylesheet" href="_ext/jquery-ui-1.10.3/themes/base/minified/jquery-ui.min.css" />
		<!-- END JQUERY / JQUERY UI -->

		<!-- OCP -->
		<script src="js/ocp/core.js"></script>
		<script src="js/ocp_misc.js"></script>
		<script src="js/ocp_file_manager.js"></script>
		<link rel="stylesheet" href="js/ocp/theme/default/core.css" />

		<!-- SPLITPANE -->
		<script src="js/ocp/widget_splitpane_h.js"></script>
		<link rel="stylesheet" href="js/ocp/theme/default/widget_splitpane_h.css" />
		<script src="js/ocp/widget_splitpane_v.js"></script>
		<link rel="stylesheet" href="js/ocp/theme/default/widget_splitpane_v.css" />
		<!-- END SPLITPANE -->

		<!-- TREE -->
		<script src="js/ocp/widget_tree.js"></script>
		<link rel="stylesheet" href="js/ocp/theme/default/widget_tree.css" />
		<!-- END TREE -->

		<!-- GRID -->
		<script src="js/ocp/widget_grid.js"></script>
		<link rel="stylesheet" href="js/ocp/theme/default/widget_grid.css" />
		<link rel="stylesheet" href="js/ocp/theme/default/widget_grid_extentions.css" />
		<!-- END GRID -->

		<!-- MENU -->
		<script src="js/ocp/widget_menu.js"></script>
		<link rel="stylesheet" href="js/ocp/theme/default/widget_menu.css" />
		<!-- END MENU -->

		<!-- DIALOG -->
		<script src="js/ocp/widget_dialog.js"></script>
		<link rel="stylesheet" href="js/ocp/theme/default/widget_dialog.css" />
		<!-- END DIALOG -->

		<script src="js/ocp/widget_layout_3r.js"></script>
		<script src="js/ocp/widget_header_content.js"></script>
		<script src="js/ocp/widget_text_value.js"></script>
		<!-- END OCP -->

	</head>

	<body>
		<!-- PAGE -->
		<div id="page">
			<div id="page_header">
				<div id="header_menu" class="header_button">Menu</div>
				<div id="file_manager_button" class="page_selector page_selector_header_content header_button">File Manager</div>
				<div id="cover_page_button" class="page_selector page_selector_header_content header_button">Home</div>
			</div>

			<!-- FILE MANAGER -->
			<div id="file_manager" class="page_content">
				<div id="ocp_fm_main">
					<div id="ocp_fm_sidebar">
						<div id="ocp_fm_sidebar_header">
							File manager
						</div>
						<div class="ocp_fm_tree" id="ocp_fm_tree"></div>
					</div>
					<div id="ocp_fm_content">
						<div id="ocp_fm_content_header">
							<div id="ocp_fm_header_top">
								<ul class="ocp_fm_button_group">
									<li id="ocp_fm_parent"><img src="image/folder_up.png" />Go to parent</li>
								</ul>
								<ul class="ocp_fm_button_group">
									<li><img src="image/up.png"/>Upload file</li>
									<li><img src="image/folder-up.png"/>Upload folder</li>
								</ul>
								<ul class="ocp_fm_button_group">
									<li><img src="image/newfolder.png"/>Create folder</li>
								</ul>
							</div>
							<div id="ocp_fm_breadcrumbs">
								<label for="ocp_fm_path">Path:</label>
								<input type="text" id="ocp_fm_path" />
							</div>
						</div>
						<div id="ocp_fm_grid"></div>
					</div>
				</div>
				<div id="ocp_fm_footer">
					<div id="ocp_fm_footer_header">
						<div id="ocp_fm_toggle_footer"></div>
						File transfers
					</div>
					<div id="ocp_fm_file_transfer"></div>
				</div>
			</div>
			<!-- FILE MANAGER END -->

			<!-- COVER PAGE -->
			<div id="cover_page" class="page_content">

				<!--
				<div class="ocp_cv_top-block">
					<div class="ocp_cv_header">
						<a href="/#privacycompany" class="ocp_cv_title">THE PRIVACY COMPANY</a>
						<h2 class="ocp_cv_subtitle">BIGGER. BETTER. FASTER. STRONGER. SAFER.</h2>
					</div>
				</div>
				<div class="ocp_cv_bottom-block">
				    <div class="ocp_cv_bottom-bg"></div>
				    <div class="ocp_cv_button"></div>
				    <div class="ocp_cv_mega"></div>
				    <div class="ocp_cv_txt" style="opacity: 0;"></div>
				    <div class="ocp_cv_inputs" id="start_uploadbutton"></div>
				    <div class="ocp_cv_cursor"></div>
				    <div class="ocp_cv_shadow"></div>
				    <a href="http://www.instra.com/" target="_blank" class="ocp_cv_insta-logo">xxx</a>
				</div>
				<div class="ocp_cv_bottom">
					<div class="bottom-block-pad">
						<div class="ocp_cv_bottom-links-block last">
							<p>Support</p>
							<a href="/#help">Help Centre</a>
							<a href="/#terms">Terms of Service</a>
							<a href="/#privacy">Privacy Policy</a>
							<a href="/#copyright">Copyright</a>
						</div>
						<div class="ocp_cv_bottom-links-block">
							<p>Community</p>
							<a href="/#contact">Contact Us</a>
							<a href="/#blog">Blog</a>
							<a href="http://www.twitter.com/KimDotcom" target="_blank">Twitter</a>
							<a href="http://www.instra.com/" target="_blank">Instra Domains</a>
						</div>
						<div class="ocp_cv_bottom-links-block">
							<p>Partnerships</p>
							<a href="/#developers">Developers</a>
							<a href="/#hosting">Hosting Partners</a>
							<a href="/#resellers">Resellers</a>
							<a href="/#resellerintro">Become a reseller</a>
						</div>
						<div class="ocp_cv_bottom-links-block">
							<p>MEGA</p>
							<a href="/#about">About us</a>
							<a href="/#privacycompany">The Privacy Company</a>
							<a href="/#register">Free Membership</a>
							<a href="/#pro">Pro Membership</a>
						</div>
						<div class="ocp_cv_copyrights">Mega Limited 2013 <span style="color:#7F7E7F">All rights reserved</span> </div>
						<div class="ocp_cv_made-in-txt">made in New Zealand</div>
						<div class="ocp_cv_clear"></div>
					</div>
				</div>
				-->
			</div>
			<!-- COVER PAGE END -->

		</div>
		<!-- PAGE END -->

		<!-- FILE MANAGER OTHERS -->
		<div id="header_menu_body">
			<a href="#general_settings" class="header_menu_settings">Settings</a>
		</div>
		<div id="ocp_fm_general_settings_dialog" title="General settings">
			Host address <input type="text" id="ocp_fm_server_base_url" value="http://localhost"/>
		</div>
		<!-- FILE MANAGER OTHERS END -->

		<script>
			var g_server_base_url = 'http://localhost';

			$('#page').ocp_header_content({ content: $('#cover_page') });

			$('#file_manager').ocp_splitpane_v({
				overflow: 'hidden',
				size: { top: null, bottom: 150 },
				fixed: 'bottom'
			});

			var general_settings_dialog = $('#ocp_fm_general_settings_dialog').ocp_dialog({
				buttons: {
					Save: function() {
						g_server_base_url = $('#ocp_fm_general_settings_dialog #ocp_fm_server_base_url').val();
						general_settings_dialog.ocp_dialog('close');
					},
					Cancel: function() {
						general_settings_dialog.ocp_dialog('close');
					}
				}
			});

			$('#header_menu').ocp_menu();
			$('#file_manager_button').ocp_menu();
			$('#cover_page_button').ocp_menu();

			$('[href=#general_settings]').click(function(e) {
				e.preventDefault();
				general_settings_dialog.ocp_dialog('open');
				general_settings_dialog.find('#server_base_url').val(g_server_base_url);
			});

			// Set splitpane to the middle row
			$("#ocp_fm_main").ocp_splitpane_h({
				source: [
					{ width: 400, }
				],
				overflow: 'hidden'
			});


			$('#ocp_fm_sidebar').ocp_header_content();
			$('#ocp_fm_content').ocp_header_content();
			$('#ocp_fm_footer').ocp_header_content();

			// Put a tree on the left pane
			var src = [
				{
					name: '',
					label: 'Root',
					image: 'image/clouddrive.png',
					type: 'dir',
					expanded: true,
					children: []
				}
			];
			var tree = $('#ocp_fm_tree').ocp_tree({
				source: src,
				ls: ajax_ls,
				open_item_error: function(path) {
					alert('Cannot go to directory ' + path);
					$('#ocp_fm_breadcrumbs input').val(path).select();
				}
			});

			function filter_dir(array) {
				array = array.slice();
				for (var i = 0; i < array.length; i++) {
					if (array[i].type != 'dir')	{
						array.splice(i, 1);
						i--;
					}
				}
				return array;
			}

			function get_tree_source() {
				return tree.widget('options', 'source');
			}

			$('#ocp_fm_breadcrumbs').ocp_text_value();

			// Put a grid on right pane

			$("#ocp_fm_grid").ocp_grid({
				column: {
					filename: {
						label: 'File name',
						width: 200,
						use_thumbnail: true
					},
					size: {
						label: 'Size',
						width: 70
					},
					last_modified: {
						label: 'Last modified',
						width: 100
					}
				},
				data: [],
				prevent_dblclick: true,

				row_dblclick: function(e) {
					console.log('our row_dblclick');
					var row = $(e.currentTarget);
					if (row.attr('data-info').indexOf('dir') != -1) {
						// TODO: BUG, take the path from a real value
						var path = $("#ocp_fm_grid").ocp_grid('option', 'state').path;
						if (!path.endsWith('/')) {
							path += '/';
						}
						var info = row.attr('data-info');
						var pat = /name:[^\/]*/g;
						var name = pat.exec(info)[0].replace('name:', '');
						$('#ocp_fm_tree').ocp_tree('open_item', path + name);
					}
				}
			});

			$("#ocp_fm_file_transfer").ocp_grid({
				column: {
					filename: {
						label: 'File name',
						width: 200
					},
					size: {
						label: 'Size',
						width: 70
					},
					last_modified: {
						label: 'Last modified',
						width: 100
					}
				},
				data: []
			});
		</script>
	</body>
</html>