<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Web OCP</title>

		 <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans">

		<!-- JQUERY / JQUERY UI -->
		<script src="../_ext/jquery-1.10.2.min.js"></script>
		<script src="../_ext/jquery-ui-1.10.3/ui/minified/jquery-ui.min.js"></script>
		<link rel="stylesheet" href="../_ext/jquery-ui-1.10.3/themes/base/minified/jquery-ui.min.css" />
		<!-- END JQUERY / JQUERY UI -->

		<!-- OCP -->
		<script src="../js/ocp/core.js"></script>
		<script src="../js/ocp-misc.js"></script>

		<!-- SPLITPANE -->
		<script src="../js/ocp/widget_splitpane_h.js"></script>
		<link rel="stylesheet" href="../js/ocp/theme/default/widget_splitpane_h.css" />
		<script src="../js/ocp/widget_splitpane_v.js"></script>
		<link rel="stylesheet" href="../js/ocp/theme/default/widget_splitpane_v.css" />
		<!-- END SPLITPANE -->

		<!-- TREE -->
		<script src="../js/ocp/widget_tree.js"></script>
		<link rel="stylesheet" href="../js/ocp/theme/default/widget_tree.css" />
		<!-- END TREE -->

		<!-- GRID -->
		<script src="../js/ocp/widget_grid.js"></script>
		<link rel="stylesheet" href="../js/ocp/theme/default/widget_grid.css" />
		<link rel="stylesheet" href="../js/ocp/theme/default/widget_grid_extentions.css" />
		<!-- END GRID -->

		<!-- MENU -->
		<script src="../js/ocp/widget_menu.js"></script>
		<link rel="stylesheet" href="../js/ocp/theme/default/widget_menu.css" />
		<!-- END MENU -->

		<!-- DIALOG -->
		<script src="../js/ocp/widget_dialog.js"></script>
		<link rel="stylesheet" href="../js/ocp/theme/default/widget_dialog.css" />
		<!-- END DIALOG -->

		<script src="../js/ocp/widget_layout_3r.js"></script>
		<script src="../js/ocp/widget_header_content.js"></script>
		<script src="../js/ocp/widget_text_value.js"></script>
		<!-- END OCP -->

		<style>
html, body {
	margin: 0px;
	padding: 0px;
	height: 100%;
	font-family: 'Open sans', serif;
	font-size: 14px;
}

#page {
	width: 100%;
	height: 100%;
}

#page_header {
	width: 100%;
	height: 50px;

	background-color: #151412;
}

#header_menu {
	margin: 12px 10px 0 0;
	float: right;
}

#header_menu_body a {
	height: 40px;
	display: block;
	padding: 8px 40px 0 55px;

	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
	color: #615F5D;
	line-height: 21px;

	background-repeat: no-repeat;
}

#header_menu_body a:hover {
	background-color: #D11E00;
	color: #FFFFFF;
}

.header_menu_settings {
	background-image: url(https://eu.static.mega.co.nz/images/mega/menu_sprite3.png);
	background-size: 32px 2102px;
	background-position: 13px -1008px;
}

.header_menu_settings:hover {
	background-position: 13px -918px;
}

#sidebar {
	background-color: #F2F2F3;
}

#sidebar_header {
	font-size: 14px;
	background-color: #D11E00;
	border: 0px;
	color: #FFFFFF;
	background-image: url(image/cloud2.png);
	background-size: 30px 30px;
	background-position: 14px center;
	padding: 15px 15px 16px 57px;
	background-repeat: no-repeat;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
	height: 50px;
}

#sidebar_header img {
	position: relative;
	top: 10px;
	margin-left: 3px;
	margin-right: 10px;
	width: 29px;
	height: 27px;
}

#tree {
	padding-top: 5px;
	padding-left: 5px;
	overflow: auto;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
}

#content {
	position: relative;
	background-color: #FFFFFF;
}

#content_header {
	background-color: #FFFFFF;
	border: 0;
	height: 85px;
}

#header_top {
	height: 50px;
	padding: 10px;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
	border-bottom: 1px solid #E1E1E1;
}

#content_menu {
	padding: 0px;
	margin: 0px;
	height: 100%;
}

#content_menu li {
	position: relative;
	display: inline-block;
	padding: 5px 8px 5px 40px;
	margin: 0px 1px;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
	height: 100%;
	background-color: #DADEE1;
	cursor: pointer;
}

#content_menu li:first-child {
	border-radius: 5px 0px 0px 5px;
}

#content_menu li:last-child {
	border-radius: 0px 5px 5px 0px;
}

#content_menu li img {
	position: absolute;
	top: 3px;
	left: 5px;
	width: 33px;
	height: 23px;
}

#breadcrumbs {
	position: relative;
	height: 25px;
	padding: 5px;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
}

#breadcrumbs input {
	display: inline-block;
	width: 100%;
	padding-left: 3px;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
}

#grid {
	width: 100%;
}

#footer {
	background-color: red;
}

#footer_header {
	background-color: #FFFFFF;
	height: 17px;
	padding: 3px 5px 3px 35px;

	border: 0;
	background-image: url(image/transfers2.png);
	background-size: 40px 100px;
	background-position: 11px 6px;
	background-repeat: no-repeat;
}

#file_transfer {
	background-color: #FFFFFF;
}

#toggle_footer {
	float: right;
	margin-right: 10px;
	width: 15px;
	height: 15px;
	cursor: pointer;

	background-image: url('https://eu.static.mega.co.nz/images/mega/transfer-arrows.png');
	background-size: 30px 30px;
	background-position: 0% 0%;
}

#toggle_footer:hover {
	background-position: 100% 0%;
}

#toggle_footer.footer_maximize {
	background-position: 0% 100%;
}

#toggle_footer.footer_maximize:hover {
	background-position: 100% 100%;
}

input {
	width: 250px;
	border-radius: 5px;
	border: 2px solid #CCCCCC;
}
		</style>
	</head>

	<body>
		<div id="page">
			<div id="page_header">
				<div id="header_menu">Menu</div>
			</div>
			<div id="page_content">
				<div id="main">
					<div id="sidebar">
						<div id="sidebar_header">
							File manager
						</div>
						<div class="tree" id="tree"></div>
					</div>
					<div id="content">
						<div id="content_header">
							<div id="header_top">
								<ul id="content_menu">
									<li><img src="image/newfolder.png"/>Create folder</li>
									<li><img src="image/up.png"/>Upload file</li>
									<li><img src="image/folder-up.png"/>Upload folder</li>
								</ul>
							</div>
							<div id="breadcrumbs">
								<label for="path">Path: </label>
								<input type="text" id="path" />
							</div>
						</div>
						<div id="grid"></div>
					</div>
				</div>
				<div id="footer">
					<div id="footer_header">
						<div id="toggle_footer"></div>
						File transfers
					</div>
					<div id="file_transfer"></div>
				</div>
			</div>
		</div>

		<div id="header_menu_body">
			<a href="#general_settings" class="header_menu_settings">Settings</a>
		</div>
		<div id="general_settings_dialog" title="General settings">
			Host address <input type="text" id="server_base_url" value="http://localhost"/>
		</div>

		<script>
			var g_server_base_url = 'http://localhost';

			$('#page').ocp_header_content();
			$('#page_content').ocp_splitpane_v({
				overflow: 'hidden',
				size: { top: null, bottom: 150 },
				fixed: 'bottom'
			});

			var general_settings_dialog = $('#general_settings_dialog').ocp_dialog({
				buttons: {
					Save: function() {
						g_server_base_url = $('#general_settings_dialog #server_base_url').val();
						general_settings_dialog.ocp_dialog('close');
					},
					Cancel: function() {
						general_settings_dialog.ocp_dialog('close');
					}
				}
			});

			$('#header_menu').ocp_menu();
			$('[href=#general_settings]').click(function(e) {
				e.preventDefault();
				general_settings_dialog.ocp_dialog('open');
				general_settings_dialog.find('#server_base_url').val(g_server_base_url);
			});

			// Set splitpane to the middle row
			$("#main").ocp_splitpane_h({
				source: [
					{ width: 400, }
				],
				overflow: 'hidden'
			});


			$('#sidebar').ocp_header_content();
			$('#content').ocp_header_content();
			$('#footer').ocp_header_content();

			var footer_restore_height = 150;
			$('#toggle_footer').click(function() {
				var new_height = 0;
				if ($(this).hasClass('footer_maximize')) { //Maximize
					new_height = footer_restore_height;
					$(this).removeClass('footer_maximize');
				} else { // Minimize
					footer_restore_height = $('#footer').outerHeight()
					new_height = $('#footer_header').outerHeight();
					$(this).addClass('footer_maximize');
				}
				var size = { bottom: new_height };
				$('#page_content').ocp_splitpane_v('resize', size);
			});

			// Put a tree on the left pane
			var src = [
				{
					name: '',
					label: 'Root',
					image: 'image/clouddrive.png',
					type: 'dir',
					expanded: true,
					children: []
				}
			];
			var tree = $('#tree').ocp_tree({
				source: src,
				ls: function(path) {
					var result = null;
					var dir_result = null;
					$.ajaxSetup({scriptCharset: "utf-8"});
					$.ajax({
  						type: "GET",
						url: g_server_base_url + '/webocp/server/endpoint/',
						async: false,
						data: {
							path: path
						},
						success: function(data) {
							result = $.parseJSON(data);
							var grid_result = ocp_build_grid_data_from_ls_enpoint(result);
							$("#grid").ocp_grid('reload', grid_result);
							$('#breadcrumbs input').val(path);
							dir_result = filter_dir(result);
						}
					});
					return dir_result;
				}
			});

			function filter_dir(array) {
				array = array.slice();
				for (var i = 0; i < array.length; i++) {
					if (array[i].type != 'dir')	{
						array.splice(i, 1);
						i--;
					}
				}
				return array;
			}

			function get_tree_source() {
				return tree.widget('options', 'source');
			}

			$('#breadcrumbs').ocp_text_value();

			// Put a grid on right pane

			$("#grid").ocp_grid({
				column: {
					filename: {
						label: 'File name',
						width: 200,
						use_thumbnail: true
					},
					size: {
						label: 'Size',
						width: 70
					},
					last_modified: {
						label: 'Last modified',
						width: 100
					}
				},
				data: [],
				prevent_dblclick: true,

				row_dblclick: function(e) {
					console.log('our row_dblclick');
					var row = $(e.currentTarget);
					if (row.attr('data-info').indexOf('dir') != -1) {
						var path = $('#breadcrumbs input').val();
						if (!path.endsWith('/')) {
							path += '/';
						}
						var info = row.attr('data-info');
						var pat = /name:[^\/]*/g;
						var name = pat.exec(info)[0].replace('name:', '');
						$('#tree').ocp_tree('open_item', path + name);
					}
				}
			});

			$("#file_transfer").ocp_grid({
				column: {
					filename: {
						label: 'File name',
						width: 200
					},
					size: {
						label: 'Size',
						width: 70
					},
					last_modified: {
						label: 'Last modified',
						width: 100
					}
				},
				data: []
			});
		</script>
	</body>
</html>