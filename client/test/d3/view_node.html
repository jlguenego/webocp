<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<base href="../.." ></base>

		<!--[if IE]><script type="text/javascript">
		    // Fix for IE ignoring relative base tags.
		    (function() {
		        var bt = document.getElementsByTagName('base')[0];
		        bt.href = bt.href;
		    })();
		</script><![endif]-->
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
		<script type="text/javascript" src="_ext/d3.v3.min.js"></script>
		<script src="_ext/jquery-1.10.2.min.js"></script>
		<script src="js/ocp.js"></script>
		<script src="js/ocp_worker_ui.js"></script>
		<script src="js/ocp_worker_ui_pool.js"></script>
		<script src="js/ocp_client.js"></script>
		<script src="js/ocp_dht.js"></script>
		<script src="js/ocp_storage.js"></script>
		<script src="js/visual/NodeMap.js"></script>
		<style type="text/css">

html, body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}

#map {
  width: 800px;
  height: 600px;
}

.ocp_node_map svg {
	position: absolute;
	background-color: rgba(255,255, 255, 0.5);
}

.ocp_node_map .node {
	cursor: pointer;
	fill: #EEEEEE;
	stroke: #AAAAAA;
	stroke-width: 3px;
}

.ocp_node_map .transparent_node {
	fill: none;
}

.ocp_node_map .link {
	stroke: red;
	stroke-width: 1;
	fill: none;
}

.ocp_node_map .node_link {
	stroke: green;
	stroke-width: 2;
	fill: none;
}

.ocp_node_map .node_link.incoming {
	stroke: blue;
}

.ocp_node_map .node_link.outgoing {
	stroke: red;
}

		</style>
	</head>

	<body>
		<input type="text" /> <button>Get Map</button>
		<div id="map"></div>
		<script type="text/javascript">
$(document).ready(function() {
	$('input').val(ocp.cfg.server_base_url + '/webocp/server/node0');
	var node_map = new ocp.visual.NodeMap();
	node_map.draw('#map');
	node_map.onnodeclick = function(node) {
		console.log(node);
	};

	$('button').click(function() {
		var url = $('input').val();

		var url = ocp.dht.get_endpoint_url({url: url}, 'get_contact_list');
		var contact_list = ocp.client.command({}, url);
		console.log(contact_list);
		node_map.data = d3.values(contact_list).filter(function(d) {
			return d.location instanceof Array;
		});
		node_map.repaint();
	});
});
    </script>
  </body>
</html>